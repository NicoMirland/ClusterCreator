[all:vars]
cluster_name={{ cluster_name }}

[kube_api_servers]
{% for i in range(cluster_config.node_classes.apiserver.count) %}
{{ cluster_config.cluster_name }}-apiserver-{{ i }} ansible_host={% if not cluster_config.networking.kube_vip.use_ipv6 %}{{ cluster_config.networking.ipv4.subnet_prefix }}.{{ cluster_config.node_classes.apiserver.start_ip + i }}{% else %}{{ cluster_config.networking.ipv6.subnet_prefix }}::{{ cluster_config.node_classes.apiserver.start_ip + i }}{% endif %} ipv4={{ cluster_config.networking.ipv4.subnet_prefix }}.{{ cluster_config.node_classes.apiserver.start_ip + i }} ipv6={{ cluster_config.networking.ipv6.subnet_prefix }}::{{ cluster_config.node_classes.apiserver.start_ip + i }} labels="{% for key, value in cluster_config.node_classes.apiserver.labels.items() %}{{ key }}={{ value }}{% if not loop.last %},{% endif %}{% endfor %}"
{% endfor %}

[kube_etcd_servers]
{% for i in range(cluster_config.node_classes.etcd.count) %}
{{ cluster_config.cluster_name }}-etcd-{{ i }} ansible_host={% if not cluster_config.networking.kube_vip.use_ipv6 %}{{ cluster_config.networking.ipv4.subnet_prefix }}.{{ cluster_config.node_classes.etcd.start_ip + i }}{% else %}{{ cluster_config.networking.ipv6.subnet_prefix }}::{{ cluster_config.node_classes.apiserver.start_ip + i }}{% endif %} etcd_index={{ i }} ipv4={{ cluster_config.networking.ipv4.subnet_prefix }}.{{ cluster_config.node_classes.apiserver.start_ip + i }} ipv6={{ cluster_config.networking.ipv6.subnet_prefix }}::{{ cluster_config.node_classes.apiserver.start_ip + i }} labels=""
{% endfor %}

[kube_worker_servers]
{% for node_class in cluster_config.node_classes %}
{% if node_class not in ['etcd', 'apiserver'] %}
{% for i in range(cluster_config.node_classes[node_class].count) %}
{{ cluster_config.cluster_name }}-{{ node_class }}-{{ i }} ansible_host={% if not cluster_config.networking.kube_vip.use_ipv6 %}{{ cluster_config.networking.ipv4.subnet_prefix }}.{{ cluster_config.node_classes[node_class].start_ip + i }}{% else %}{{ cluster_config.networking.ipv6.subnet_prefix }}::{{ cluster_config.node_classes.apiserver.start_ip + i }}{% endif %} ipv4={{ cluster_config.networking.ipv4.subnet_prefix }}.{{ cluster_config.node_classes.apiserver.start_ip + i }} ipv6={{ cluster_config.networking.ipv6.subnet_prefix }}::{{ cluster_config.node_classes.apiserver.start_ip + i }} labels="{% for key, value in cluster_config.node_classes[node_class].labels.items() %}{{ key }}={{ value }}{% if not loop.last %},{% endif %}{% endfor %}"
{% endfor %}
{% endif %}
{% endfor %}
